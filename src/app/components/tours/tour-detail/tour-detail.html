<div class="tour-detail-page">

    <!-- Header Banner -->
    <app-header class="-mt-20" [title]="tourTitle" [subtitle]="tourSubtitle" [backgroundImage]="backgroundImage">
    </app-header>

    <!-- Quote Banner -->
    <div class="relative -mt-24 mb-12 z-40" #quoteCard>
        <div class="max-w-7xl mx-auto px-4">
            <!-- Card-->
            <div class="bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden">

                <!-- Header Card: Badge + Titolo + Prezzo -->
                <div class="bg-gradient-to-r from-slate-50 to-white px-4 sm:px-6 lg:px-8 py-5 border-b border-slate-200">
                    <!-- Badge Personalizzabile
                    <div class="mx-auto text-center mb-3">
                        <span
                            class="inline-block px-3 sm:px-4 py-1.5 text-xs font-bold uppercase tracking-wide bg-gradient-to-r from-teal-500 to-teal-600 text-white rounded-full shadow-md">
                            <i class="pi pi-pencil mr-1 text-xs"></i>
                            100% Personalizzabile
                        </span>
                    </div> -->

                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                        <!-- Nome Tour + Descrizione -->
                        <div class="flex-1">
                            <h2
                                class="text-xl text-center sm:text-left sm:text-2xl lg:text-3xl font-bold text-slate-900 mb-2">
                                {{ tourTitle }}
                            </h2>
                            <p class="text-xs sm:text-sm text-slate-600 leading-relaxed text-center sm:text-left">
                                Quota su base 1 partecipante in media stagione.
                            </p>
                        </div>

                        <!-- Prezzo in Evidenza -->
                        <div class="text-center lg:text-right flex-shrink-0 px-4 py-0 lg:ml-6">
                            <div class="text-xs font-semibold text-teal-700 uppercase tracking-wide mb-1">
                                Prezzo da
                            </div>
                            <div class="text-4xl sm:text-5xl font-bold text-teal-600 mb-1">
                                {{ priceFrom }}€
                            </div>
                            <div class="text-xs text-slate-600">*a persona</div>
                        </div>
                    </div>
                </div>

                <!-- Body Card: Info Grid -->
                <div class="px-4 sm:px-6 lg:px-8 py-5">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-3 sm:gap-4">

                        <!-- Numero Partecipanti -->
                        <div
                            class="flex items-center gap-3 p-2.5 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors">
                            <div
                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center flex-shrink-0">
                                <i class="pi pi-users text-white text-base"></i>
                            </div>
                            <div>
                                <div class="text-xs text-red-watabi font-semibold uppercase">Partecipanti</div>
                                <div class="text-xs text-slate-900">min. {{ minParticipants }}</div>
                            </div>
                        </div>

                        <!-- Durata -->
                        <div
                            class="flex items-center gap-3 p-2.5 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors">
                            <div
                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                                <i class="pi pi-calendar text-white text-base"></i>
                            </div>
                            <div>
                                <div class="text-xs text-red-watabi font-semibold uppercase">Durata</div>
                                <div class="text-xs text-slate-900">{{ totalDays }} giorni</div>
                            </div>
                        </div>

                        <!-- Pernottamenti -->
                        <div
                            class="flex items-center gap-3 p-2.5 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors">
                            <div
                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center flex-shrink-0">
                                <i class="pi pi-home text-white text-base"></i>
                            </div>
                            <div>
                                <div class="text-xs text-red-watabi font-semibold uppercase">Pernottamenti</div>
                                <div class="text-xs text-slate-900">{{ totalNights }} {{ totalNights === 1 ?
                                    'notte' : 'notti' }}</div>
                            </div>
                        </div>

                        <!-- Trasporti -->
                        <div
                            class="flex items-center gap-3 p-2.5 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors">
                            <div
                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center flex-shrink-0">
                                <i class="pi pi-car text-white text-base"></i>
                            </div>
                            <div>
                                <div class="text-xs text-red-watabi font-semibold uppercase">Trasporti</div>
                                <div class="text-xs text-slate-900">{{ transportType }}</div>
                            </div>
                        </div>

                        <!-- Pasti -->
                        <div
                            class="flex items-center gap-3 p-2.5 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors">
                            <div
                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-rose-500 to-rose-600 flex items-center justify-center flex-shrink-0">
                                <i class="pi pi-shopping-bag text-white text-base"></i>
                            </div>
                            <div>
                                <div class="text-xs text-red-watabi font-semibold uppercase">Pasti</div>
                                <div class="text-xs text-slate-900">{{ mealsIncluded }}</div>
                            </div>
                        </div>

                        <!-- Periodo Consigliato -->
                        <div
                            class="flex items-center gap-3 p-2.5 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors">
                            <div
                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center flex-shrink-0">
                                <i class="pi pi-calendar-clock text-white text-base"></i>
                            </div>
                            <div>
                                <div class="text-xs text-red-watabi font-semibold uppercase">Periodo</div>
                                <div class="text-xs text-slate-900">{{ recommendedPeriod }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SEZIONE TIPS -->
                <div
                    class="px-4 sm:px-6 lg:px-8 py-5 bg-gradient-to-br from-teal-50/50 to-blue-50/50 border-t border-slate-200">
                    <div class="max-w-5xl mx-auto">
                        <!-- Header Tips -->
                        <div class="text-center mb-4">
                            <h3 class="text-base sm:text-lg font-bold text-slate-900 mb-1">
                                <i class="pi pi-lightbulb text-amber-500 mr-1 text-sm"></i>
                                Personalizza il Tuo Viaggio
                            </h3>
                            <p class="text-xs text-slate-600">Aggiungi estensioni, esperienze e servizi extra</p>
                        </div>

                        <!-- Tips Grid -->
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 mb-4">
                            <!-- TIP 1 -->
                            <div
                                class="bg-white rounded-lg p-3 border border-teal-200 hover:border-teal-400 hover:shadow-md transition-all cursor-pointer">
                                <div class="flex items-center gap-2 mb-2">
                                    <div
                                        class="w-8 h-8 rounded-lg bg-teal-100 flex items-center justify-center flex-shrink-0">
                                        <i class="pi pi-globe text-teal-600 text-sm"></i>
                                    </div>
                                    <h4 class="font-bold text-xs text-slate-900">Estensioni</h4>
                                </div>
                                <p class="text-xs text-slate-600 leading-relaxed">
                                    Mare o città asiatiche
                                </p>
                            </div>

                            <!-- TIP 2 -->
                            <div
                                class="bg-white rounded-lg p-3 border border-purple-200 hover:border-purple-400 hover:shadow-md transition-all cursor-pointer">
                                <div class="flex items-center gap-2 mb-2">
                                    <div
                                        class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center flex-shrink-0">
                                        <i class="pi pi-calendar-plus text-purple-600 text-sm"></i>
                                    </div>
                                    <h4 class="font-bold text-xs text-slate-900">Date Libere</h4>
                                </div>
                                <p class="text-xs text-slate-600 leading-relaxed">
                                    Parti quando vuoi
                                </p>
                            </div>

                            <!-- TIP 3 -->
                            <div
                                class="bg-white rounded-lg p-3 border border-amber-200 hover:border-amber-400 hover:shadow-md transition-all cursor-pointer">
                                <div class="flex items-center gap-2 mb-2">
                                    <div
                                        class="w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center flex-shrink-0">
                                        <i class="pi pi-star text-amber-600 text-sm"></i>
                                    </div>
                                    <h4 class="font-bold text-xs text-slate-900">Upgrade</h4>
                                </div>
                                <p class="text-xs text-slate-600 leading-relaxed">
                                    Hotel 4★ o Ryokan
                                </p>
                            </div>

                            <!-- TIP 4 -->
                            <div
                                class="bg-white rounded-lg p-3 border border-rose-200 hover:border-rose-400 hover:shadow-md transition-all cursor-pointer">
                                <div class="flex items-center gap-2 mb-2">
                                    <div
                                        class="w-8 h-8 rounded-lg bg-rose-100 flex items-center justify-center flex-shrink-0">
                                        <i class="pi pi-sparkles text-rose-600 text-sm"></i>
                                    </div>
                                    <h4 class="font-bold text-xs text-slate-900">Esperienze</h4>
                                </div>
                                <p class="text-xs text-slate-600 leading-relaxed">
                                    Guide, transfer, attività
                                </p>
                            </div>
                        </div>

                        <!-- CTA - P -->
                        <div class="text-center">
                            <button (click)="requestQuote()"
                                class="inline-flex items-center gap-2 bg-gradient-to-r from-teal-500 to-teal-600 text-white px-6 py-3 rounded-xl font-bold text-sm shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300">
                                <i class="pi pi-send"></i>
                                <span>Richiedi Preventivo Personalizzato</span>
                                <i class="pi pi-arrow-right"></i>
                            </button>
                            <p class="text-xs text-slate-600 mt-2">
                                <i class="pi pi-clock mr-1 text-teal-600"></i>
                                Risposta entro 24h dai nostri esperti
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Footer Card: Disclaimer -->
                <div class="bg-slate-50 px-6 py-4 border-t border-slate-200">
                    <div class="flex items-start gap-2 mx-auto">
                        <i class="pi pi-info-circle text-teal-600 mt-0.5 flex-shrink-0 text-sm"></i>
                        <p class="text-xs text-slate-700 leading-relaxed">
                            <span class="font-semibold text-slate-900">Nota:</span>
                            Prezzo in media stagione. In <span class="font-semibold text-red-watabi">alta
                                stagione</span>
                            (ciliegi/autunno) potrebbero essere applicati dei supplementi.
                            <span class="font-semibold text-teal-700">I nostri esperti ti risponderanno
                                personalmente</span> con preventivo dettagliato.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STICKY CTA BAR -->
    <div #stickyCta
        class="fixed bottom-0 left-0 right-0 z-[9999] bg-white/95 backdrop-blur-md shadow-2xl border-t border-slate-200 transition-all duration-300"
        [class.translate-y-0]="showStickyCta" [class.opacity-100]="showStickyCta"
        [class.translate-y-full]="!showStickyCta" [class.opacity-0]="!showStickyCta"
        [class.pointer-events-none]="!showStickyCta" [class.pointer-events-auto]="showStickyCta">
        <div class="max-w-7xl mx-auto px-4 py-3 sm:py-4">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4">
                <div class="hidden sm:block">
                    <h3 class="text-base lg:text-lg font-bold text-slate-900">{{ tourTitle }}</h3>
                    <p class="text-xs lg:text-sm text-slate-600">{{ tourSubtitle }}</p>
                </div>

                <div class="flex items-center gap-3 sm:gap-6 w-full sm:w-auto">
                    <div class="text-center sm:text-right">
                        <div class="text-xs text-slate-500">da</div>
                        <div class="text-2xl sm:text-3xl font-bold text-teal-600">{{ priceFrom }}€</div>
                        <div class="text-xs text-slate-600">a persona</div>
                    </div>

                    <button (click)="requestQuote()"
                        class="flex-1 sm:flex-initial bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2">
                        <span class="text-sm sm:text-base">Richiedi preventivo</span>
                        <i class="pi pi-arrow-right text-sm"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Tour Intro Section -->
    <div class="bg-gradient-to-br from-slate-50 to-white py-8 sm:py-12 border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-4 sm:mb-6 text-center">
                    Cosa troverai nel <span class="text-red-watabi">Tour Yuki</span>
                </h2>
                <div class="prose prose-sm sm:prose-lg max-w-none text-slate-700 leading-relaxed space-y-3 sm:space-y-4">
                    <p class="text-sm sm:text-base">
                        {{ tourIntroduction }}
                    </p>
                </div>

                <!-- Quick Highlights - Responsive Grid -->
                <div class="mt-6 sm:mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                    @for(highlight of quickHighlights; track highlight.label) {
                    <div
                        class="flex items-center gap-3 p-3 sm:p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                        <div
                            class="w-10 h-10 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center flex-shrink-0">
                            <i [class]="'pi ' + highlight.icon + ' text-white text-sm sm:text-base'"></i>
                        </div>
                        <div>
                            <div class="text-sm font-bold text-slate-900">{{ highlight.label }}</div>
                            <div class="text-xs text-slate-600">{{ highlight.value }}</div>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumbs 
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="flex items-center gap-2 text-sm">
            @for(crumb of breadcrumbs; track crumb.label; let last = $last) {
            <span>
                @if(crumb.route) {
                <a [routerLink]="crumb.route"
                    class="text-slate-600 hover:text-red-watabi transition-colors cursor-pointer">
                    {{ crumb.label }}
                </a>
                } @else {
                <span class="text-slate-900 font-semibold">{{ crumb.label }}</span>
                }
            </span>
            @if(!last) {
            <i class="pi pi-angle-right text-slate-400 text-xs"></i>
            }
            }
        </div>
    </div>-->

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 pb-16">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left Column - Tour Content -->
            <div class="lg:col-span-2 space-y-12 mt-12">

                <!-- Tour Stops -->
                @for(stop of tourStops; track stop.city; let idx = $index) {
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-slate-100">

                    <!-- City Header -->
                    <div
                        class="bg-gradient-to-r from-red-watabi to-red-dark px-6 py-4 flex items-center justify-between">
                        <!-- Titolo a sinistra -->
                        <div>
                            <h2 class="text-2xl font-bold text-white uppercase">{{ stop.city }}</h2>
                        </div>
                        <!-- Notti a destra -->
                        <div class="text-right">
                            <div class="text-2xl font-bold text-white">{{ stop.nights }}</div>
                            <div class="text-xs font-medium text-white/90">{{ stop.nights === 1 ? 'notte' : 'notti' }}
                            </div>
                        </div>
                    </div>

                    <!-- Images Gallery -->
                    <div class="grid grid-cols-3 gap-2 p-4 bg-slate-50">
                        @for(image of stop.images; track image) {
                        <div class="relative aspect-video rounded-lg overflow-hidden group cursor-pointer">
                            <img [src]="image" [alt]="stop.city"
                                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                            <div
                                class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                <i class="pi pi-search-plus text-white text-2xl"></i>
                            </div>
                        </div>
                        }
                    </div>

                    <!-- TAB NAVIGATION -->
                    <div class="border-b border-slate-200 bg-slate-50 px-6">
                        <div class="flex gap-1">
                            <button (click)="selectTab(stop.city, 'description')"
                                [class.bg-white]="getActiveTab(stop.city) === 'description'"
                                [class.border-b-2]="getActiveTab(stop.city) === 'description'"
                                [class.border-red-watabi]="getActiveTab(stop.city) === 'description'"
                                [class.text-red-watabi]="getActiveTab(stop.city) === 'description'"
                                [class.font-bold]="getActiveTab(stop.city) === 'description'"
                                class="px-4 py-3 text-sm font-medium text-slate-600 hover:text-red-watabi hover:bg-white/50 transition-colors rounded-t-lg">
                                <i class="pi pi-align-left mr-2"></i>
                                Descrizione
                            </button>
                            <button (click)="selectTab(stop.city, 'places')"
                                [class.bg-white]="getActiveTab(stop.city) === 'places'"
                                [class.border-b-2]="getActiveTab(stop.city) === 'places'"
                                [class.border-red-watabi]="getActiveTab(stop.city) === 'places'"
                                [class.text-red-watabi]="getActiveTab(stop.city) === 'places'"
                                [class.font-bold]="getActiveTab(stop.city) === 'places'"
                                class="px-4 py-3 text-sm font-medium text-slate-600 hover:text-red-watabi hover:bg-white/50 transition-colors rounded-t-lg">
                                <i class="pi pi-map-marker mr-2"></i>
                                Luoghi di Interesse
                            </button>
                            <button (click)="selectTab(stop.city, 'excursions')"
                                [class.bg-white]="getActiveTab(stop.city) === 'excursions'"
                                [class.border-b-2]="getActiveTab(stop.city) === 'excursions'"
                                [class.border-red-watabi]="getActiveTab(stop.city) === 'excursions'"
                                [class.text-red-watabi]="getActiveTab(stop.city) === 'excursions'"
                                [class.font-bold]="getActiveTab(stop.city) === 'excursions'"
                                class="px-4 py-3 text-sm font-medium text-slate-600 hover:text-red-watabi hover:bg-white/50 transition-colors rounded-t-lg">
                                <i class="pi pi-compass mr-2"></i>
                                Escursioni nei Dintorni
                            </button>
                        </div>
                    </div>

                    <!-- TAB CONTENT -->
                    <div class="p-6 bg-white">

                        <!-- Tab: Descrizione -->
                        @if(getActiveTab(stop.city) === 'description') {
                        <div class="space-y-4 animate-fade-in">
                            <p class="text-slate-700 leading-relaxed">
                                {{ stop.description }}
                            </p>
                        </div>
                        }

                        <!-- Tab: Luoghi di Interesse -->
                        @if(getActiveTab(stop.city) === 'places') {
                        <div class="space-y-3 animate-fade-in">
                            <p class="text-sm text-slate-600 mb-4">I principali luoghi che visiterai durante il soggiorno
                                a {{ stop.city }}:</p>
                            @for(place of stop.highlights; track place) {
                            <div
                                class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200 hover:border-red-watabi transition-colors">
                                <i class="pi pi-map-marker text-red-watabi mt-1 text-lg"></i>
                                <div>
                                    <h4 class="font-semibold text-slate-900">{{ place }}</h4>
                                    <p class="text-xs text-slate-600">Incluso nell'itinerario</p>
                                </div>
                            </div>
                            }
                        </div>
                        }

                        <!-- Tab: Escursioni nei Dintorni -->
                        @if(getActiveTab(stop.city) === 'excursions') {
                        <div class="space-y-4 animate-fade-in">
                            @if(stop.nearbyExcursions && stop.nearbyExcursions.length > 0) {
                            <p class="text-sm text-slate-600 mb-4">Durante il soggiorno a {{ stop.city }}, sono previste
                                queste escursioni nei dintorni:</p>
                            @for(excursion of stop.nearbyExcursions; track excursion.name) {
                            <div
                                class="p-4 bg-gradient-to-r from-teal-50 to-blue-50 rounded-lg border-2 border-teal-200">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-12 h-12 rounded-full bg-teal-500 flex items-center justify-center flex-shrink-0">
                                        <i class="pi pi-directions text-white text-xl"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between mb-2">
                                            <h4 class="font-bold text-slate-900 text-lg">{{ excursion.name }}</h4>
                                            <span
                                                class="text-xs font-semibold text-teal-600 bg-white px-2 py-1 rounded-full">
                                                {{ excursion.distance }}
                                            </span>
                                        </div>
                                        <p class="text-sm text-slate-700 mb-3">{{ excursion.description }}</p>
                                        <div class="flex items-center gap-4 text-xs text-slate-600">
                                            <span><i class="pi pi-clock mr-1"></i>{{ excursion.duration }}</span>
                                            <span><i class="pi pi-car mr-1"></i>{{ excursion.transport }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            }
                            } @else {
                            <div class="text-center py-8">
                                <i class="pi pi-info-circle text-slate-400 text-4xl mb-3"></i>
                                <p class="text-slate-600">Nessuna escursione prevista nei dintorni durante questo
                                    soggiorno.</p>
                            </div>
                            }
                        </div>
                        }
                    </div>
                </div>
                }

                <!-- Price Packages -->
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        @for(pkg of pricePackages; track pkg.name) {
                        <div class="rounded-xl overflow-hidden shadow-xl border border-slate-200">

                            <!-- Header -->
                            <div class="p-6 text-center text-white" [ngClass]="{
                       '!bg-gradient-to-br !from-teal-500 !to-teal-600': pkg.color === 'teal',
                       'bg-gradient-to-br from-blue-500 to-blue-600': pkg.color === 'gold'
                     }">
                                <div class="flex justify-center gap-1 mb-3">
                                    @for(star of getStarsArray(pkg.stars); track $index) {
                                    <i class="pi pi-star-fill text-white text-xl"></i>
                                    }
                                </div>
                                <h3 class="text-2xl font-bold mb-2">{{ pkg.name }}</h3>
                                <p class="text-white/90 text-sm mb-4">a partire da</p>
                                <div class="text-5xl font-bold">€ {{ pkg.price }}</div>
                            </div>

                            <!-- Features -->
                            <div class="p-6 bg-white space-y-3">
                                @for(feature of pkg.features; track feature) {
                                <div class="flex items-start gap-3">
                                    <i class="pi pi-check text-teal-600 mt-1"></i>
                                    <span class="text-slate-700 text-sm">{{ feature }}</span>
                                </div>
                                }
                            </div>
                        </div>
                        }
                    </div>
                </div>

                <!-- Info Sections -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <!-- Scheda Informativa -->
                    <div>
                        <h2 class="text-3xl font-bold text-slate-900 mb-6">Scheda <span
                                class="text-red-watabi">Informativa</span></h2>
                        <div class="space-y-4">
                            @for(section of infoSections; track section.title) {
                            <details class="group bg-white rounded-xl border border-slate-200 overflow-hidden">
                                <summary
                                    class="px-6 py-4 cursor-pointer hover:bg-slate-50 transition-colors flex justify-between items-center">
                                    <span class="font-semibold text-slate-900">{{ section.title }}</span>
                                    <i
                                        class="pi pi-chevron-down text-teal-600 group-open:rotate-180 transition-transform"></i>
                                </summary>
                                <div class="px-6 pb-4 text-slate-700 text-sm leading-relaxed">
                                    {{ section.content }}
                                </div>
                            </details>
                            }
                        </div>
                    </div>

                    <!-- Non Include -->
                    <div>
                        <h2 class="text-3xl font-bold text-slate-900 mb-6">Cosa <span class="text-red-watabi">Non
                                Include</span></h2>
                        <div class="bg-white rounded-xl border border-slate-200 p-6">
                            <div class="space-y-3">
                                @for(item of notIncluded; track item) {
                                <div class="flex items-start gap-3">
                                    <i class="pi pi-times text-red-500 mt-1"></i>
                                    <span class="text-slate-700 text-sm">{{ item }}</span>
                                </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">
                        Mappa <span class="text-red-watabi">dell'Itinerario</span>
                    </h2>
                    <!-- Usa i valori di default - MOCK-->
                    <app-tour-map></app-tour-map>
                    <!-- 
                    Passare i dati corretti delle città custom da API 
                    <app-tour-map [cities]="tourCities"></app-tour-map>
                    -->
                </div>

            </div>

            <!-- Right Column - Sidebar -->
            <div class="lg:col-span-1 mt-12">
                <div class="sticky top-24 space-y-6">

                    <!-- CARD STILE DI VIAGGIO -->
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="bg-gradient-to-r from-red-watabi to-red-dark p-4">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                    <i class="pi pi-chart-bar text-white text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="text-base font-bold text-white">Stile del Viaggio</h3>
                                    <p class="text-xs text-white/90">A colpo d'occhio</p>
                                </div>
                            </div>
                        </div>

                        <div class="p-5 space-y-4">
                            @for(metric of tourStyleMetrics; track metric.label) {
                            <div>
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <i [class]="'pi ' + metric.icon + ' text-' + metric.color + '-600 text-sm'"></i>
                                        <span class="text-xs font-semibold text-slate-900">{{ metric.label }}</span>
                                    </div>
                                    <span [class]="'text-xs font-bold text-' + metric.color + '-600'">{{ metric.level
                                        }}</span>
                                </div>
                                <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
                                    <div [class]="'h-full bg-gradient-to-r from-' + metric.color + '-500 to-' + metric.color + '-600 rounded-full transition-all duration-500'"
                                        [style.width.%]="metric.value"></div>
                                </div>
                            </div>
                            }
                        </div>

                        <div class="bg-slate-50 px-4 py-3 border-t border-slate-200">
                            <div class="flex items-start gap-2">
                                <i class="pi pi-info-circle text-teal-600 text-xs mt-0.5 flex-shrink-0"></i>
                                <p class="text-xs text-slate-600 leading-relaxed">
                                    Questi valori sono indicativi e possono variare in base alle <span
                                        class="font-semibold">tue personalizzazioni</span>.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- CALL TO ACTION - COME FUNZIONA IL TOUR INDIVIDUALE -->
                    <div
                        class="bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl shadow-xl overflow-hidden border-2 border-teal-400">
                        <div class="p-6 text-white">
                            <div class="flex items-center gap-3 mb-4">
                                <div
                                    class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                    <i class="pi pi-info-circle text-white text-xl"></i>
                                </div>
                                <h3 class="text-lg font-bold">Come Funziona?</h3>
                            </div>

                            <p class="text-white/95 text-sm leading-relaxed mb-4">
                                Scopri come organizziamo i <span class="font-bold">tour individuali su misura</span> per
                                te e come possiamo personalizzare ogni aspetto del viaggio.
                            </p>

                            <ul class="space-y-3 mb-6">
                                <li class="flex items-start gap-3">
                                    <i class="pi pi-check-circle text-white flex-shrink-0 mt-0.5"></i>
                                    <span class="text-sm text-white/95">Itinerario completamente personalizzabile</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="pi pi-check-circle text-white flex-shrink-0 mt-0.5"></i>
                                    <span class="text-sm text-white/95">Assistenza 24/7 durante il viaggio</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="pi pi-check-circle text-white flex-shrink-0 mt-0.5"></i>
                                    <span class="text-sm text-white/95">Partenza in qualsiasi data</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="pi pi-check-circle text-white flex-shrink-0 mt-0.5"></i>
                                    <span class="text-sm text-white/95">App dedicata con itinerario digitale</span>
                                </li>
                            </ul>

                            <button (click)="navigateTo('/come-funziona-tour-individuale')"
                                class="w-full bg-white text-teal-600 py-3 rounded-xl font-bold hover:bg-teal-50 transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <span>Scopri di più</span>
                                <i class="pi pi-arrow-right text-sm"></i>
                            </button>
                        </div>
                    </div>

                    <!-- VIAGGIO E VOLO -->
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <!-- Header con gradiente -->
                        <div class="bg-gradient-to-r from-red-watabi to-red-dark p-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                    <i class="pi pi-map text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Viaggio e Volo</h3>
                                    <p class="text-xs text-white/90">Tutto quello che devi sapere sul tour</p>
                                </div>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="p-6 space-y-4">
                            <div class="flex items-start gap-3">
                                <i class="pi pi-star-fill text-amber-500 mt-1 flex-shrink-0"></i>
                                <div>
                                    <span class="text-slate-700 text-sm">Il nostro </span>
                                    <span class="font-bold text-red-watabi">Best Seller</span>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <i class="pi pi-users text-teal-600 mt-1 flex-shrink-0"></i>
                                <div>
                                    <span class="text-slate-700 text-sm">Ideale per </span>
                                    <span class="font-bold text-slate-900">tutti i tipi di viaggiatori</span>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <i class="pi pi-home text-purple-600 mt-1 flex-shrink-0"></i>
                                <div>
                                    <span class="text-slate-700 text-sm">Personalizzabile con una notte in </span>
                                    <span class="font-bold text-slate-900">Ryokan</span>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <i class="pi pi-send text-blue-600 mt-1 flex-shrink-0"></i>
                                <div>
                                    <span class="text-slate-700 text-sm">Volo da </span>
                                    <span class="font-bold text-slate-900">Milano Malpensa</span>
                                </div>
                            </div>

                            <!-- Divisore -->
                            <div class="border-t border-slate-200 my-4"></div>

                            <!-- Trustpilot Reviews -->
                            <div
                                class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-lg p-4 border border-amber-200">
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex gap-0.5">
                                        <i class="pi pi-star-fill text-amber-500 text-sm"></i>
                                        <i class="pi pi-star-fill text-amber-500 text-sm"></i>
                                        <i class="pi pi-star-fill text-amber-500 text-sm"></i>
                                        <i class="pi pi-star-fill text-amber-500 text-sm"></i>
                                        <i class="pi pi-star-fill text-amber-500 text-sm"></i>
                                    </div>
                                    <span class="text-sm font-bold text-slate-900">Eccellente</span>
                                </div>
                                <p class="text-xs text-slate-700 mb-3">
                                    <span class="font-bold">218 viaggiatori</span> ci hanno scelto per il loro viaggio
                                    in Giappone
                                </p>
                                <button (click)="navigateTo('https://trustpilot.com')"
                                    class="w-full bg-gradient-to-r from-amber-500 to-amber-600 text-white py-2 rounded-lg font-semibold text-sm hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                                    <i class="pi pi-star-fill"></i>
                                    <span>Leggi le recensioni</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ESTENSIONI DISPONIBILI -->
                    @if(availableExtensions && availableExtensions.length > 0) {
                    <div class="rounded-xl shadow-lg border-2 border-red-watabi overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-br from-red-watabi to-red-dark p-6 border-b border-teal">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                    <i class="pi pi-globe text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">Estensioni Mare & Città</h3>
                                    <p class="text-xs text-white/90">Arricchisci il tuo viaggio</p>
                                </div>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="p-6">
                            <p class="text-sm text-slate-700 mb-4 leading-relaxed">
                                Aggiungi un'estensione al tuo tour del Giappone per un'esperienza ancora più completa.
                            </p>

                            <!-- Lista Estensioni Compatte -->
                            <div class="space-y-3 mb-4">
                                @for(ext of availableExtensions.slice(0, 3); track ext.id) {
                                <div (click)="selectExtensionFromSidebar(ext)"
                                    [class.ring-2]="selectedExtension?.id === ext.id"
                                    [class.ring-red-watabi]="selectedExtension?.id === ext.id"
                                    [class.bg-red-watabi/5]="selectedExtension?.id === ext.id"
                                    class="group relative border-2 border-slate-200 rounded-xl overflow-hidden hover:border-red-watabi hover:shadow-md transition-all cursor-pointer">

                                    <div class="flex gap-3 p-3">
                                        <!-- Mini Image -->
                                        <div class="w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden">
                                            <img [src]="ext.image" [alt]="ext.name"
                                                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                                        </div>

                                        <!-- Info -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between mb-1">
                                                <h4 class="font-bold text-sm text-slate-900 truncate">{{ ext.name }}</h4>
                                                @if(selectedExtension?.id === ext.id) {
                                                <i class="pi pi-check-circle text-red-watabi flex-shrink-0 ml-2"></i>
                                                }
                                            </div>
                                            <p class="text-xs text-slate-600 mb-2 line-clamp-2">{{ ext.description }}</p>
                                            <div class="flex items-center justify-between">
                                                <span class="text-red-watabi font-bold text-sm">da €{{ ext.priceFrom
                                                    }}</span>
                                                <span class="text-xs text-slate-500">{{ ext.nights }} notti</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Selected Badge -->
                                    @if(selectedExtension?.id === ext.id) {
                                    <div
                                        class="absolute top-2 right-2 bg-red-watabi text-white text-xs px-2 py-0.5 rounded-full font-bold shadow-md">
                                        Selezionata
                                    </div>
                                    }
                                </div>
                                }
                            </div>

                            <!-- Mostra tutte Button -->
                            @if(availableExtensions.length > 3) {
                            <button (click)="showExtensionModal = true"
                                class="w-full py-2.5 text-sm text-red-watabi font-semibold border-2 border-red-watabi rounded-lg hover:bg-red-watabi hover:text-white transition-all flex items-center justify-center gap-2">
                                <span>Vedi tutte le {{ availableExtensions.length }} estensioni</span>
                                <i class="pi pi-arrow-right text-xs"></i>
                            </button>
                            }

                            <!-- Info Badge -->
                            <div class="mt-4 bg-white/80 backdrop-blur-sm rounded-lg p-3 border border-sakura">
                                <div class="flex items-start gap-2">
                                    <i class="pi pi-lightbulb text-amber-500 mt-0.5 flex-shrink-0"></i>
                                    <p class="text-xs text-slate-700">
                                        Le estensioni sono <span class="font-semibold">facoltative</span> e possono
                                        essere aggiunte durante la richiesta del preventivo.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    }

                    <!-- ESPERIENZE AGGIUNTIVE -->
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div
                                    class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                    <i class="pi pi-star text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Optional</h3>
                                    <p class="text-xs text-white/90">Opzioni aggiuntive selezionate per te
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="p-6 space-y-3">
                            <div
                                class="flex items-start gap-3 p-3 bg-purple-50 rounded-lg border border-purple-200 hover:border-purple-400 transition-colors cursor-pointer">
                                <i class="pi pi-ticket text-purple-600 mt-1 flex-shrink-0"></i>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-sm text-slate-900 mb-1">Transfer Privati</h4>
                                    <p class="text-xs text-slate-600">Comfort massimo negli spostamenti</p>
                                </div>
                            </div>

                            <div
                                class="flex items-start gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200 hover:border-blue-400 transition-colors cursor-pointer">
                                <i class="pi pi-eye text-blue-600 mt-1 flex-shrink-0"></i>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-sm text-slate-900 mb-1">Visite Guidate Private</h4>
                                    <p class="text-xs text-slate-600">Scopri i luoghi con un esperto locale</p>
                                </div>
                            </div>

                            <div
                                class="flex items-start gap-3 p-3 bg-teal-50 rounded-lg border border-teal-200 hover:border-teal-400 transition-colors cursor-pointer">
                                <i class="pi pi-shield text-teal-600 mt-1 flex-shrink-0"></i>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-sm text-slate-900 mb-1">Assicurazione Annullamento</h4>
                                    <p class="text-xs text-slate-600">Viaggia senza pensieri</p>
                                </div>
                            </div>

                            <button (click)="navigateTo('/esperienze')"
                                class="w-full mt-4 py-2.5 text-sm text-purple-600 font-semibold border-2 border-purple-600 rounded-lg hover:bg-purple-600 hover:text-white transition-all flex items-center justify-center gap-2">
                                <span>Scopri tutte le esperienze</span>
                                <i class="pi pi-arrow-right text-xs"></i>
                            </button>
                        </div>
                    </div>

                    <!-- CONTATTI -->
                    <div
                        class="bg-gradient-to-br from-slate-50 to-white rounded-xl shadow-lg border border-slate-200 p-6">
                        <div class="flex items-center gap-3 mb-4">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-red-watabi to-red-dark flex items-center justify-center">
                                <i class="pi pi-phone text-white text-xl"></i>
                            </div>
                            <h3 class="text-lg font-bold text-slate-900">Hai domande?</h3>
                        </div>

                        <p class="text-sm text-slate-700 mb-4 leading-relaxed">
                            Il nostro team di esperti è a tua disposizione per qualsiasi informazione.
                        </p>

                        <div class="space-y-3 mb-4">
                            <a href="tel:3332221234"
                                class="flex items-center gap-3 p-3 bg-white rounded-lg border border-slate-200 hover:border-red-watabi hover:shadow-md transition-all group">
                                <div
                                    class="w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center group-hover:bg-teal-500 transition-colors">
                                    <i class="pi pi-phone text-teal-600 group-hover:text-white transition-colors"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-slate-500">Telefono</div>
                                    <div class="text-sm font-bold text-slate-900">333 222 1234</div>
                                </div>
                            </a>

                            <a href="https://wa.me/3332221234" target="_blank"
                                class="flex items-center gap-3 p-3 bg-white rounded-lg border border-slate-200 hover:border-red-watabi hover:shadow-md transition-all group">
                                <div
                                    class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center group-hover:bg-green-500 transition-colors">
                                    <i
                                        class="pi pi-whatsapp text-green-600 group-hover:text-white transition-colors"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-slate-500">WhatsApp</div>
                                    <div class="text-sm font-bold text-slate-900">333 222 1234</div>
                                </div>
                            </a>

                            <button (click)="navigateTo('/services')"
                                class="w-full flex items-center gap-3 p-3 bg-white rounded-lg border border-slate-200 hover:border-red-watabi hover:shadow-md transition-all group">
                                <div
                                    class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center group-hover:bg-purple-500 transition-colors">
                                    <i class="pi pi-at text-purple-600 group-hover:text-white transition-colors"></i>
                                </div>
                                <div class="text-left">
                                    <div class="text-xs text-slate-500">Mail</div>
                                    <div class="text-sm font-bold text-slate-900">info@watabi.it</div>
                                </div>
                            </button>
                        </div>

                        <div class="bg-teal-50 rounded-lg p-3 border border-teal-200">
                            <div class="flex items-start gap-2">
                                <i class="pi pi-clock text-teal-600 mt-0.5 flex-shrink-0"></i>
                                <div>
                                    <p class="text-xs font-semibold text-slate-900 mb-1">Orari di apertura</p>
                                    <p class="text-xs text-slate-700">Lun-Ven: 9:00 - 18:00</p>
                                    <p class="text-xs text-slate-700">Sab: 9:00 - 13:00</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Modal Extension Selector -->
            <app-extension-selector [tourId]="tourId" [availableExtensionIds]="availableExtensionIds"
                [isOpen]="showExtensionModal" (close)="showExtensionModal = false"
                (extensionSelected)="onExtensionSelected($event)">
            </app-extension-selector>

        </div>
    </div>
    <app-related-tours [currentTourId]="'giappone-classico'" [currentCategory]="'individual'"
        [currentCities]="['Tokyo', 'Kyoto', 'Hiroshima', 'Kanazawa']"
        [currentTags]="['su misura', 'flessibile', 'classico']" [maxResults]="3"></app-related-tours>
</div>